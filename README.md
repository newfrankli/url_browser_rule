# URL浏览器规则管理器

一个根据规则使用不同浏览器打开链接的工具，支持自定义匹配模式和浏览器映射，提供基于PyQt5的高级GUI界面。

## 功能特点

### 基础功能
- 🔗 支持自定义URL协议 `urlrule://`
- 🎨 基于PyQt5的高级GUI界面
- 👻 透明输入框设计，深色/透明背景
- 📋 可视化规则管理（查看、添加、编辑、删除、批量导入）
- 🌐 支持多种浏览器：Chrome、Firefox、Edge、Safari、默认浏览器
- 📝 灵活的匹配规则（支持域名或URL包含匹配）
- ⚡ 轻量级设计，核心依赖仅PyQt5
- 🖥️ 支持Windows系统
- 📊 实时操作日志记录

### 高级GUI功能
- 📌 默认显示在桌面最底层
- 🖱️ 点击冒号标签可拖动窗口
- 🎛️ 右键点击冒号标签可调整缩放比例
- 📋 直接输入URL按回车即可访问
- 📦 系统托盘图标支持
- 📱 托盘菜单包含：设置、开机自启动、锁定位置、锁定大小、锁定比例、退出
- ✅ 功能状态可视化（带对勾标记）
- 🚀 支持开机自启动
- 🔒 支持锁定位置、大小和比例
- 📋 输入框右侧内置粘贴按钮
- 🎨 自定义右键菜单，支持撤销、恢复、剪切、复制、粘贴、删除、全选
- 📤 支持批量导入URL规则

## 安装与使用

### 1. 环境要求

- Python 3.6+
- Windows系统
- 已安装需要的浏览器（Chrome、Firefox、Edge等）
- 依赖：PyQt5

### 2. 安装依赖

```bash
pip install PyQt5
```

### 3. 快速开始

#### 3.1 运行程序

```bash
python url_browser_rule_advanced_pyqt.py
```

#### 3.2 使用透明输入框

- 程序启动后会在桌面显示一个透明的输入框
- 输入URL后按回车或点击"访问"按钮即可打开
- 自动补全协议（无需手动输入http://）

#### 3.3 窗口操作

- **拖动窗口**：点击中间的冒号标签，按住左键拖动
- **调整缩放**：右键点击冒号标签，按住并上下拖动
- **调整大小**：拖动窗口边框

#### 3.4 系统托盘

- 程序会在系统托盘显示图标
- 右键点击图标显示菜单
- 菜单包含：设置、开机自启动、锁定位置、锁定大小、锁定比例、退出
- 已启用的功能前会显示对勾标记

#### 3.5 规则管理

1. **打开设置**：
   - 右键点击托盘图标，选择"设置"
   - 或在规则管理界面中操作

2. **规则管理界面**：
   - 查看所有规则
   - 添加单条规则
   - 编辑选中规则
   - 删除选中规则
   - 批量导入规则

3. **批量导入规则**：
   - 点击"批量导入"按钮
   - 在文本框中输入URL列表，每行一个
   - 从下拉框中选择要使用的浏览器
   - 点击确定完成批量导入
   - 自动生成描述和ID

## 规则配置

### 规则格式

规则保存在 `rules.json` 文件中，格式如下：

```json
[
  {
    "id": 1,
    "pattern": "google.com",
    "browser": "chrome",
    "description": "Google使用Chrome"
  }
]
```

### 参数说明

- `id`：规则唯一标识符
- `pattern`：匹配模式，可以是域名或URL中的关键词
- `browser`：指定的浏览器，可选值：`chrome`、`firefox`、`edge`、`safari`、`default`
- `description`：规则描述

### 匹配逻辑

- 程序会检查URL的域名或完整URL是否包含规则中的 `pattern`
- 如果匹配到多条规则，以第一条匹配的规则为准
- 如果没有匹配到规则，使用默认浏览器打开

## 浏览器映射

程序会根据以下映射调用浏览器：

| 配置值   | 实际调用的可执行文件 |
|---------|---------------------|
| chrome  | chrome.exe          |
| firefox | firefox.exe         |
| edge    | msedge.exe          |
| safari  | safari.exe          |
| default | 系统默认浏览器      |

## 注意事项

1. 首次使用需要注册URL协议（程序会自动注册）
2. 确保浏览器可执行文件在系统PATH中，或能通过注册表找到
3. 规则修改后会立即生效并保存到文件
4. 建议使用 `pythonw.exe` 运行程序，避免命令行窗口闪烁
5. 支持开机自启动，可在托盘菜单中开启

## 运行方式

### 命令行模式

直接运行处理URL：
```bash
python url_browser_rule_advanced_pyqt.py "urlrule://www.google.com"
```

### 后台运行

如果不想看到命令行窗口，可以：
1. 将 `python` 替换为 `pythonw`
2. 或创建快捷方式，目标设置为：
   ```
pythonw.exe "D:\path\to\url_browser_rule_advanced_pyqt.py"
   ```

## 开发说明

### 核心功能

- `register_protocol()`：注册URL协议
- `handle_url()`：处理URL请求，根据规则选择浏览器
- `read_rules()` / `save_rules()`：读写规则文件
- `find_browser_path()`：查找浏览器可执行文件路径（优先使用注册表）
- `setup_tray()`：设置系统托盘图标和菜单

### 文件结构

```
.
├── url_browser_rule_advanced_pyqt.py  # PyQt5高级GUI版本（唯一版本）
├── url.ico                            # 应用图标
├── rules.json                         # 规则配置文件
├── config.json                        # 应用配置文件
└── README.md                          # 使用说明文档
```

## 安全性说明

- 已修复命令注入漏洞，使用安全的执行方式
- 不再自动安装依赖，避免破坏用户Python环境
- 使用Python内置方法打开默认浏览器
- 移除了不安全的回退方案

## 更新日志

### v3.0.0（最新版本）
- 🎉 迁移到PyQt5框架
- 👻 改进透明背景效果
- 📋 输入框右侧添加粘贴按钮
- 🎨 自定义右键菜单
- 📤 支持批量导入URL规则
- 🔒 修复安全性问题
- 🚀 优化浏览器路径查找（优先使用注册表）
- 🔧 移除自动安装依赖逻辑
- 📝 更新README文档

### v2.0.0
- 🎉 新增高级GUI版本
- 👻 透明输入框设计
- 📌 默认显示在桌面最底层
- 🖱️ 支持拖动位置
- 🎛️ 支持调整大小
- 📦 系统托盘图标和菜单
- ✅ 功能状态可视化
- 🚀 支持开机自启动
- 🔒 支持锁定位置和大小

---

**使用提示：** 定期备份 `rules.json` 和 `config.json` 文件，以免配置丢失。